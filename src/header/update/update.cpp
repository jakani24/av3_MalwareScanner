#ifndef UPDATE_CPP
#define UPDATE_CPP
#include "../os.h"
#include "update.h"
#include <iostream>
int download_files()
{
	char buf[500];
	for (int i=0;i<db_files;i++)
	{
		#ifdef os_win
		sprintf(buf,"curl https://virusshare.com/hashfiles/VirusShare_%.5d.md5 -o c:\\programdata\\jakach\\se\\hashes\\%d.md5",i,i);
		#endif
		#ifdef os_linux
		sprintf(buf,"curl https://virusshare.com/hashfiles/VirusShare_%.5d.md5 -o /etc/jakach/%d.md5",i,i);
		#endif
		printf("downloading file %d = %.1f%% \n",i,(float)100/db_files*i);
		system(buf);
	}
	return 0;
}
int make_db()
{
	//FILE*bf;
	FILE*files[36];
	FILE*fp;
	char hash[55];
	char path[500];
	#ifdef os_win
	//if((bf=fopen("c:\\programdata\\jakach\\se\\hashes\\hash_database.jdbf","w"))==0)
	files[0]=fopen("c:\\programdata\\jakach\\se\\hashes\\a.jdbf","w");
	files[1]=fopen("c:\\programdata\\jakach\\se\\hashes\\b.jdbf","w");
	files[2]=fopen("c:\\programdata\\jakach\\se\\hashes\\c.jdbf","w");
	files[3]=fopen("c:\\programdata\\jakach\\se\\hashes\\d.jdbf","w");
	files[4]=fopen("c:\\programdata\\jakach\\se\\hashes\\e.jdbf","w");
	files[5]=fopen("c:\\programdata\\jakach\\se\\hashes\\f.jdbf","w");
	files[26]=fopen("c:\\programdata\\jakach\\se\\hashes\\0.jdbf","w");
	files[27]=fopen("c:\\programdata\\jakach\\se\\hashes\\1.jdbf","w");
	files[28]=fopen("c:\\programdata\\jakach\\se\\hashes\\2.jdbf","w");
	files[29]=fopen("c:\\programdata\\jakach\\se\\hashes\\3.jdbf","w");
	files[30]=fopen("c:\\programdata\\jakach\\se\\hashes\\4.jdbf","w");
	files[31]=fopen("c:\\programdata\\jakach\\se\\hashes\\5.jdbf","w");
	files[32]=fopen("c:\\programdata\\jakach\\se\\hashes\\6.jdbf","w");
	files[33]=fopen("c:\\programdata\\jakach\\se\\hashes\\7.jdbf","w");
	files[34]=fopen("c:\\programdata\\jakach\\se\\hashes\\8.jdbf","w");
	files[35]=fopen("c:\\programdata\\jakach\\se\\hashes\\9.jdbf","w");
	#endif
	#ifdef os_linux
	//if((bf=fopen("/etc/jakach/hash_database.jdbf","w"))==0)
	files[0]=fopen("/etc/jakach/a.jdbf","w");
	files[1]=fopen("/etc/jakach/b.jdbf","w");
	files[2]=fopen("/etc/jakach/c.jdbf","w");
	files[3]=fopen("/etc/jakach/d.jdbf","w");
	files[4]=fopen("/etc/jakach/e.jdbf","w");
	files[5]=fopen("/etc/jakach/f.jdbf","w");
	files[26]=fopen("/etc/jakach/0.jdbf","w");
	files[27]=fopen("/etc/jakach/1.jdbf","w");
	files[28]=fopen("/etc/jakach/2.jdbf","w");
	files[29]=fopen("/etc/jakach/3.jdbf","w");
	files[30]=fopen("/etc/jakach/4.jdbf","w");
	files[31]=fopen("/etc/jakach/5.jdbf","w");
	files[32]=fopen("/etc/jakach/6.jdbf","w");
	files[33]=fopen("/etc/jakach/7.jdbf","w");
	files[34]=fopen("/etc/jakach/8.jdbf","w");
	files[35]=fopen("/etc/jakach/9.jdbf","w");	
	#endif
	//{
	//	return 1;
	//}

	for(int i=0;i<db_files;i++)
	{
		#ifdef os_win
		sprintf(path,"c:\\programdata\\jakach\\se\\hashes\\%d.md5",i);
		#endif
		#ifdef os_linux
		sprintf(path,"/etc/jakach/%d.md5",i);
		#endif

		printf("creating database file(%.1f%%) \n",(float)100/db_files*i);
		if((fp=fopen(path,"r"))==0)
		{
			return 2;
		}
		else
		{
			while(!feof(fp))
			{
				fscanf(fp,"%50s",&hash);
				switch(hash[0])
				{
					case 'a':
						fprintf(files[0],"%s\n",hash);
					break;
											case 'b':
						fprintf(files[1],"%s\n",hash);
					break;
											case 'c':
						fprintf(files[2],"%s\n",hash);
					break;
											case 'd':
						fprintf(files[3],"%s\n",hash);
					break;
											case 'e':
						fprintf(files[4],"%s\n",hash);
					break;
											case 'f':
						fprintf(files[5],"%s\n",hash);
					break;
											case '0':
						fprintf(files[26],"%s\n",hash);
					break;
											case '1':
						fprintf(files[27],"%s\n",hash);
					break;
											case '2':
						fprintf(files[28],"%s\n",hash);
					break;
											case '3':
						fprintf(files[29],"%s\n",hash);
					break;
											case '4':
						fprintf(files[30],"%s\n",hash);
					break;
											case '5':
						fprintf(files[31],"%s\n",hash);
					break;
											case '6':
						fprintf(files[32],"%s\n",hash);
					break;
											case '7':
						fprintf(files[33],"%s\n",hash);
					break;
											case '8':
						fprintf(files[34],"%s\n",hash);
					break;
											case '9':
						fprintf(files[35],"%s\n",hash);
					break;
					default:
						//printf("Unknown file %s\n",hash);	
					break;
				}
			//	fprintf(bf,"%s\n",hash);
			}
			fclose(fp);
		}
	}	
	//fclose(bf);	
	fclose(files[0]);
	fclose(files[1]);
	fclose(files[2]);
	fclose(files[3]);
	fclose(files[4]);
	fclose(files[5]);
	
	fclose(files[26]);
	fclose(files[27]);
	fclose(files[28]);
	fclose(files[29]);
	fclose(files[30]);
	fclose(files[31]);
	fclose(files[32]);
	fclose(files[34]);
	fclose(files[33]);
	fclose(files[35]);
	printf("done 100%%\n");		

	return 0;
}
int donwload_preindexed_files()
{	
	short i=0;
	char buf[500];
	char files[]="abcdef0123456789";
	for(int i=0;i<strlen(files);i++)
	{
		#ifdef os_win
		sprintf(buf,"curl http://jakach.duckdns.org:441/server/%c.jdbf -o c:\\programdata\\jakach\\se\\hashes\\%c.jdbf",files[i],files[i]);
		#endif
		#ifdef os_linux
		//fÃ¼r lokal auf raspi mit 192.168.27.15 arbeiten, da duckdns adresse u localhost weitergeleitet wird :(
		sprintf(buf,"curl http://jakach.duckdns.org:441/server/%c.jdbf -o -o /etc/jakach/%c.jdbf",files[i],files[i];
		#endif
		printf("downloading file %c = %.1f%% \n",files[i],(float)100/strlen(files)*i);
		system(buf);
	}

	printf("done 100%%\n");		
	return 0;
}
#endif